version: 2.1

executors:
  ubuntu:
    environment:
      JVM_OPTS: -Xmx3200m
      TERM: dumb
    machine:
      image: ubuntu-2404:2025.09.1
      docker_layer_caching: true
    resource_class: arm.large

jobs:
  jdk21:
    executor: ubuntu
    steps:
      - run: |
          sudo apt-get update
          sudo apt-get install -y wget apt-transport-https
          wget -O - https://packages.adoptium.net/artifactory/api/gpg/key/public | sudo apt-key add -
          echo "deb https://packages.adoptium.net/artifactory/deb $(lsb_release -sc) main" | sudo tee /etc/apt/sources.list.d/adoptium.list
          sudo apt-get update
          sudo apt-get install -y temurin-21-jdk
      - checkout
      - run: ./gradlew build --no-daemon -Dorg.gradle.workers.max=2
  jdk24:
    executor: ubuntu
    steps:
      - run: |
          sudo apt-get update
          sudo apt-get install -y wget apt-transport-https
          wget -O - https://packages.adoptium.net/artifactory/api/gpg/key/public | sudo apt-key add -
          echo "deb https://packages.adoptium.net/artifactory/deb $(lsb_release -sc) main" | sudo tee /etc/apt/sources.list.d/adoptium.list
          sudo apt-get update
          sudo apt-get install -y temurin-24-jdk
      - checkout
      - run: ./gradlew build --no-daemon -Dorg.gradle.workers.max=2

workflows:
  gradle-build:
    jobs:
      - jdk21
      - jdk24
